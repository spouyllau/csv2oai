<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Serveur OAI-PMH pour fichier CSV - interface avancée</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        section { margin-bottom: 40px; }
        textarea { width: 100%; height: 200px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        input, select, button { margin: 5px 0; padding: 5px; }
    </style>
</head>
<body>
<h1>Interface avancée pour tester le serveur OAI-PMH</h1>
<p>Interface de requêtes des différents verbes de l'entrepôt OAI-PMH. Dans ce serveur de démo, le fichier <a href="https://github.com/spouyllau/csv2oai/blob/main/data.csv" target="_blank">data.csv</a> est utilisé. Les sections ci-dessous 
servent à soit modifier et enregistrer le fichier data.csv permettant de voir les résultats immédiatement ou encore à charger un nouveau data.csv, avec de nouvelle métadonnées en Dublin Core Element Set.</p>
  
<section>
    <h2>Tester les requêtes OAI-PMH</h2>
    <form id="oaiForm">
    <!-- <form method="get" action="oai-pmh.php" target="_blank"> -->
        <label>Verbe:
            <select name="verb">
                <option value="Identify">Identify</option>
                <option value="ListMetadataFormats">ListMetadataFormats</option>
                <option value="ListIdentifiers">ListIdentifiers</option>
                <option value="ListRecords">ListRecords</option>
                <option value="GetRecord">GetRecord</option>
                <option value="ListSets">ListSets</option>
            </select>
        </label>
        <br>
        <label>metadataPrefix: <input type="text" name="metadataPrefix" value="oai_dc"></label>
        <br>
        <label>identifier: <input type="text" name="identifier"></label>
        <br>
        <label>set: <input type="text" name="set"></label>
        <br>
        <label>resumptionToken: <input type="text" name="resumptionToken"></label>
        <br>
        <button type="submit">Envoyer la requête</button>
    </form>

    <textarea id="output" readonly></textarea>

  <script>
    document.getElementById('oaiForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const params = new URLSearchParams();
      for (const el of form.elements) {
        if (el.name && el.value) {
          params.append(el.name, el.value);
        }
      }
      const url = 'oai-pmh.php?' + params.toString();
      const res = await fetch(url);
      const text = await res.text();
      document.getElementById('output').value = text;
    });
  </script>

</section>

<section>
    <h2>Visualiser et éditer data.csv</h2>
    <form id="save-csv-form">
        <textarea id="csv-editor"></textarea>
        <br>
        <button type="button" onclick="saveCSV()">Enregistrer les modifications</button>
    </form>
</section>

<section>
    <h2>Téléverser un nouveau fichier data.csv</h2>
    <form id="upload-form" action="upload.php" method="post" enctype="multipart/form-data">
        <input type="file" name="csvfile" accept=".csv">
        <button type="submit">Téléverser</button>
    </form>
</section>

<script>
// Charger le contenu du CSV
fetch('data.csv')
    .then(response => response.text())
    .then(text => document.getElementById('csv-editor').value = text);

// Sauvegarde des modifications CSV (via POST AJAX vers save.php)
function saveCSV() {
    const data = document.getElementById('csv-editor').value;
    fetch('save.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'csv=' + encodeURIComponent(data)
    })
    .then(res => res.ok ? alert("CSV sauvegardé.") : alert("Erreur lors de la sauvegarde."));
}
</script>
</body>
</html>
